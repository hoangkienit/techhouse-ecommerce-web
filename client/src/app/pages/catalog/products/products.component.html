<nb-card [isLoading]="isLoading">
    <nb-card-header>
        <div class="mb-2">Danh sách sản phẩm</div>
        <!-- Filters -->
        <div class="filter-wrapper d-flex flex-wrap gap-2 mb-3">
            <nb-select [(selected)]="selectedCategory" placeholder="Danh mục" (selectedChange)="onFilterChange()">
                <nb-option value="">Lọc theo danh mục sản phẩm</nb-option>
                <nb-option *ngFor="let c of categoryList" [value]="c.label">{{c.label}}</nb-option>
            </nb-select>

            <nb-select [(selected)]="selectedBrand" placeholder="Thương hiệu" (selectedChange)="onFilterChange()">
                <nb-option value="">Lọc theo thương hiệu</nb-option>
                <nb-option *ngFor="let b of brandList" [value]="b.label">{{b.label}}</nb-option>
            </nb-select>

            <nb-select [(selected)]="selectedSort" placeholder="Sắp xếp" (selectedChange)="onFilterChange()">
                <nb-option value="">Sắp xếp</nb-option>
                <nb-option *ngFor="let s of SortActionLs" [value]="s.value">{{s.value | sortLabel}}</nb-option>
            </nb-select>

            <input nbInput placeholder="Tên sản phẩm" [(ngModel)]="searchName" (input)="onFilterChange()">

            <div class="d-flex gap-1">
                <input nbInput placeholder="Giá từ" [value]="_currencyHelper.minValue" (input)="onMinInput($event)">
                <input nbInput placeholder="Đến" [value]="_currencyHelper.maxValue" (input)="onMaxInput($event)">
                <button nbButton status="primary" (click)="onFilterChange()">Search</button>
            </div>
        </div>
    </nb-card-header>
    <nb-card-body>
        <!-- Product Grid -->
        <div class="product-grid d-flex flex-wrap gap-3">
            <ng-container *ngIf="products && products.length; else empty">
                <nb-card *ngFor="let p of products" class="product-card" style="width: 200px;"
                    (click)="goToDetail(p._id)">
                    <nb-card-body class="p-0">
                        <div class="img-wrapper">
                            <img class="w-100" [src]="p.product_imgs[0]" [alt]="p.product_name"
                                (error)="onImgError($event)">
                        </div>
                        <div class="p-2">
                            <div class="fw-bold text-truncate">{{ p.product_name }}</div>
                            <div class="text-muted text-truncate">{{ p.product_category }} | {{ p.product_brand }}</div>
                            <div class="text-danger fw-bold mt-1">{{ formatPrice(p.product_price) }}</div>
                        </div>
                    </nb-card-body>
                </nb-card>
            </ng-container>
        </div>

        <ng-template #empty>
            <div class="text-center text-muted fw-bold mt-3">
                Không có sản phẩm nào.
            </div>
        </ng-template>

        <!-- Pagination -->
        <div class="mt-3 d-flex justify-content-around align-items-center w-100">
            <div class="w-40">
                <ngx-paging [pageIndex]="_paging.pageIndex" [pageSize]="_paging.pageSize"
                    [totalItems]="_paging.totalItems" (onPageChange)="onPageChange($event)">
                </ngx-paging>
            </div>
        </div>

    </nb-card-body>
</nb-card>